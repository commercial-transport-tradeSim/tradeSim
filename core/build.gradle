/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'tradeSim.java-library-conventions'
    id 'java'
    id 'jacoco'
}

apply plugin: 'maven-publish'

dependencies {
	implementation 'org.yaml:snakeyaml:1.8',
				   'com.opencsv:opencsv:3.7',
				   'org.mozilla:rhino:1.7.13',
				   'org.mozilla:rhino-engine:1.7.13'
	
	compileOnly 'org.projectlombok:lombok:1.18.20',
				'org.apache.logging.log4j:log4j-api:2.8',
  				'org.apache.logging.log4j:log4j-core:2.8'
	
	annotationProcessor 'org.projectlombok:lombok:1.18.20'
	
	testCompileOnly 'org.projectlombok:lombok:1.18.20'
	testAnnotationProcessor 'org.projectlombok:lombok:1.18.20'
}
 
javadoc {
    options.addBooleanOption('html5', true)
}

task browseJavaDoc() {
	dependsOn javadoc
	group 'application'

	doLast {
		browse "${rootDir}/core/build/docs/javadoc/index.html"
	}
}

test {
    finalizedBy jacocoTestReport // report is always generated after tests run
}
jacocoTestReport {
    dependsOn test // tests are required to run before generating the report
}

def browse(path) {
    def os = org.gradle.internal.os.OperatingSystem.current()
    if (os.isWindows()) {
        exec { commandLine 'cmd', '/c', "start $path" }
    } else if (os.isMacOsX()) {
        exec { commandLine 'open', "$path" }
    }
}


publishing {
    publications {
        maven(MavenPublication) {
			groupId = 'tradeSim'
			artifactId = 'core'
			version = '0.1.0'
			
			from components.java
			
			pom {
				licenses {
					license {
						name = 'GNU GENERAL PUBLIC LICENSE, Version 3'
						url = 'https://www.gnu.org/licenses/gpl-3.0.txt'
						distribution = 'repo'
					}
				}
			}
		}

	}
	
}

tasks.withType(GenerateMavenPom).all {
    def matcher = name =~ /generatePomFileFor(\w+)Publication/
    def publicationName = matcher[0][1]
    destination = layout.buildDirectory.file("poms/pom.xml").get().asFile
}